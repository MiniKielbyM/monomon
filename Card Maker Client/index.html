<html>

<head>
    <!-- Load Blockly core -->
    <script src="https://unpkg.com/blockly/blockly_compressed.js"></script>
    <!-- Load the default blocks -->
    <script src="https://unpkg.com/blockly/blocks_compressed.js"></script>
    <!-- Load the JavaScript generator -->
    <script src="https://unpkg.com/blockly/javascript_compressed.js"></script>
    <!-- Load messages -->
    <script src="https://unpkg.com/blockly/msg/en.js"></script>
    <style>
        body {
            overflow: hidden;
        }
    </style>
</head>

<body style="margin:0;">

    <!-- Blockly workspace -->
    <div id="blocklyDiv" style="height: 60vh; width: 75vw;"></div>
    <div id="output" style="height: 40vh; width: 75vw; border-top: 1px solid #ccc;"></div>


    <script>
        // Define custom block
        const definitions = Blockly.common.createBlockDefinitionsFromJsonArray([
            {
                type: 'meta_header',
                message0: 'METADATA',
                message1: 'FIELD_NAME: %1',
                args0: [
                    {
                        type: 'input_value',
                        name: 'FIELD_NAME',
                        value: 10
                    },
                    {
                        type: 'input_value',
                        name: 'qweqwe',
                        value: 10
                    }
                ],
                nextStatement: null,
            }
        ]);

        // Register block definition
        Blockly.common.defineBlocks(definitions);

        // Get JavaScript generator
        const javascriptGenerator = Blockly.JavaScript;

        // Define code generator for the block
        javascriptGenerator.forBlock['my_custom_block'] = function (block, generator) {
            var steps = block.getFieldValue('FIELD_NAME');
            var qweqwe = block.getFieldValue('qweqwe');
            return 'moveForward(' + steps + ');\n';
        };

        // Inject Blockly
        const workspace = Blockly.inject('blocklyDiv', {
            toolbox: `<xml xmlns="https://developers.google.com/blockly/xml">
                <category name="MetaData" colour="#ff6a00">
                    <block type="meta_header"></block>
                </category>
            </xml>`,
            theme: Blockly.Themes.Dark,
            trashcan: true,
            move: {
                scrollbars: {
                    horizontal: false,
                    vertical: false
                },
                drag: false,
                wheel: false
            },
            renderer: 'Thrasos'
        });
                // Function called when button is clicked
        function runCode() {
            const code = javascriptGenerator.workspaceToCode(workspace);
            console.log("Generated code:\n" + code);

            // Example function so the code can actually run
            function moveForward(steps) {
                alert("Moving forward " + steps + " steps!");
            }

            try {
                eval(code); // Run the generated code
            } catch (e) {
                console.error("Error executing code:", e);
            }
        }
        workspace.addChangeListener(function (event) {
            // Example: log block additions
            if (!event.isUiEvent) {
                console.log('Block created:', event);
            }

            // Other types: BLOCK_DELETE, BLOCK_MOVE, BLOCK_CHANGE, UI, etc.
        });

    </script>
</body>

</html>